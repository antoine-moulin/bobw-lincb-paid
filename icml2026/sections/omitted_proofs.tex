\section{Temp Antoine}

    \subsection{Regret analysis}

Recall the definition of the regret
%
\begin{align*}
    R_T &= \bbE \sbr*{\sumtT \spr*{\ell_t \spr*{X_t, A_t} - \ell_t \spr*{X_t, \pi_T^\star \spr*{X_t}}}} + c\,\bbE \sbr*{\sumtT \abs*{O_t}}\\
    &= \bbE \sbr*{\sumtT \sumaK \spr*{q_t \spr*{a \given X_t} - \pi_T^\star \spr*{a \given X_t}} \inp*{X_t, \theta_{t, a}}} + c K\,\bbE \sbr*{\sumtT p_t \spr*{X_t}},
\end{align*}
%
where we used the fact that $\bbE \sbr*{\ell_t \spr*{X_t, a} \given \cH_{t - 1}} = \inp*{X_t, \theta_{t, a}}$ for any $a \in \sbr*{K}$ for the first term, and that $\bbE \sbr*{\abs*{O_t} \given \cH_{t - 1}, X_t} = K p_t \spr*{X_t}$ for the second term, which holds because at time $t$, each arm $a$ is observed with probability $p_t \spr*{X_t}$.

We introduce a ghost sample $X_0 \sim \cD$ independent from $\cH_T$. Conditional on $\cH_{t-1}$, both $X_t$ and $X_0$ are \iid from $\cD$, and $p_t$ is $\cH_{t-1}$-measurable, hence, we have
%
\begin{equation*}
    \bbE \sbr*{p_t \spr*{X_t} \given \cH_{t - 1}} = \bbE \sbr*{p_t \spr*{X_0} \given \cH_{t - 1}}.
\end{equation*}
%
Recall the definition of the importance-weighted estimator $\wh{\theta}_{t, a} = \Sigma_{t, a}^{-1} X_t \ell_t \spr*{X_t, a} \mathds{1}_{\scbr*{a \in O_t}}$ and note that $\bbE \sbr*{\wh{\theta}_{t, a} \given \cH_{t-1}} = \theta_{t, a}$. By Lemma~\ref{lem:ghost-sample-neu}, we can further rewrite the regret as
%
\begin{align*}
    R_T &= \bbE \sbr*{\sumtT \sumaK \spr*{q_t \spr*{a \given X_0} - \pi_T^\star \spr*{a \given X_0}} \inp*{X_0, \wh{\theta}_{t, a}}} + c K\,\bbE \sbr*{\sumtT p_t \spr*{X_0}}\\
    &= \bbE \sbr*{\sumtT \sumaK \spr*{q_t \spr*{a \given X_0} - \pi_T^\star \spr*{a \given X_0}} \inp*{X_0, \wt{\theta}_{t, a}}} + c K\,\bbE \sbr*{\sumtT p_t \spr*{X_0}}\\
    &\quad+ \bbE \sbr*{\sumtT \sumaK \spr*{q_t \spr*{a \given X_0} - \pi_T^\star \spr*{a \given X_0}} \inp*{X_0, \wh{\theta}_{t, a} - \wt{\theta}_{t, a}}}\\
    &\leq \bbE \sbr*{\sumtT \sumaK \spr*{q_t \spr*{a \given X_0} - \pi_T^\star \spr*{a \given X_0}} \inp*{X_0, \wt{\theta}_{t, a}}} + c K\,\bbE \sbr*{\sumtT p_t \spr*{X_0}}\\
    &\quad+ 2 \sumtT \max_{a \in \sbr*{K}} \abs*{\bbE \sbr*{\inp*{X_0, \wh{\theta}_{t, a} - \wt{\theta}_{t, a}}}}.
\end{align*}
%
where $\wt{\theta}_{t, a}$ are is MGR estimate defined as $\wt{\theta}_{t, a} = \Sigma_t^+ X_t \ell_t \spr*{X_t, a} \mathds{1}_{\scbr*{a \in O_t}}$ (see Eq.~\ref{eq::MGR_estimate}). For any context $x \in \cX$, we define the auxiliary regret
%
\begin{equation*}
    \wt R_T \spr*{x} \coloneqq \sumtT \sumaK \spr*{q_t \spr*{a \given x} - \pi_T^\star \spr*{a \given x}} \inp*{x, \wt{\theta}_{t, a}} + c K \sumtT p_t \spr*{x}
\end{equation*}
%
and the bias induced by MGR
%
\begin{equation*}
    \biasmgr \coloneqq \sumtT \max_{a \in \sbr*{K}} \abs*{\bbE \sbr*{\inp*{X_0, \wh{\theta}_{t, a} - \wt{\theta}_{t, a}}}}.
\end{equation*}
%
With this notation, we can write the inequality above as
%
\begin{equation*}
    R_T \leq \bbE_{X_0 \sim \cD} \sbr*{\wt R_T \spr*{X_0}} + 2\,\biasmgr.
\end{equation*}
%
We bound the two terms separately. In Lemma~\ref{lem::boundBias} we prove that the bias induced by MGR is upper bounded as
%
\begin{equation*}
    2 \biasmgr \leq \frac{\pi^2}{3}\,.
\end{equation*}
%
Thus, it remains to upper bound $\bbE_{X_0 \sim \cD} \sbr*{\wt R_T \spr*{X_0}}$. Let us fix a context $x \in \cX$ and recall that at time $t$, the distribution $q_t \spr*{\cdot \given x}$ is
%
\begin{equation*}
    q_t \spr*{\cdot \given x} = \argmin_{q \in \Delta_K} \scbr*{\sum_{s=1}^{t-1} \sumaK q \spr*{a} \inp*{x, \wt{\theta}_{s, a}} + \cR_t \spr*{q}},
\end{equation*}
%
where we denoted $\cR_t \spr*{q} = \frac{1}{\eta_t} \spr*{- H_\alpha \spr*{q}} + \bar\beta \spr*{- H_{\bar\alpha} \spr*{q}}$. By the standard FTRL analysis \citep[Exercise~28.12]{BanditBook}, we have
%
\begin{align*}
    \wt R_T \spr*{x} &\leq \sumtT \spr*{\sumaK \spr*{q_t \spr*{a \given x} - q_{t+1} \spr*{a \given x}} \inp*{x, \wt \theta_{t, a}} - D_{\cR_t} \spr*{q_{t+1} \spr*{\cdot \given x}, q_t \spr*{\cdot \given x}}}\\
    &\quad+ \cR_{T+1} \spr*{\pi_T^\star \spr*{\cdot \given x}} - \cR_1 \spr*{q_1 \spr*{\cdot \given x}} + \sumtT \spr*{\frac{1}{\eta_{t+1}} - \frac{1}{\eta_t}} H_{\alpha} \spr*{q_{t+1} \spr*{\cdot \given x}}\\
    &\quad+ c K \sumtT p_t \spr*{x}.
\end{align*}
%
